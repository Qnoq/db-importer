name: Deploy to Production VPS

# Deployment triggers:
# 1. Automatic: when pushing to 'main' branch
# 2. Manual: click "Run workflow" button in GitHub Actions tab
on:
  push:
    branches:
      - main
  workflow_dispatch:  # Allows manual trigger from GitHub UI

jobs:
  deploy:
    name: Deploy to Hostinger VPS
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout code
        uses: actions/checkout@v4

      - name: üöÄ Deploy to Hostinger VPS
        uses: hostinger/deploy-on-vps@v2
        with:
          api-key: ${{ secrets.HOSTINGER_API_KEY }}
          virtual-machine: ${{ vars.HOSTINGER_VM_ID }}
          docker-compose-path: docker-compose.yml
          environment-variables: |
            PORT=${{ vars.PORT || '8080' }}
            ALLOWED_ORIGINS=${{ vars.ALLOWED_ORIGINS }}
            VITE_API_URL=${{ vars.VITE_API_URL }}
            MAX_UPLOAD_SIZE=${{ vars.MAX_UPLOAD_SIZE || '52428800' }}
            DEBUG_LOG=${{ vars.DEBUG_LOG || 'false' }}
            RATE_LIMIT_ENABLED=${{ vars.RATE_LIMIT_ENABLED || 'true' }}
            RATE_LIMIT_REQUESTS=${{ vars.RATE_LIMIT_REQUESTS || '50' }}
            RATE_LIMIT_WINDOW=${{ vars.RATE_LIMIT_WINDOW || '60' }}

      - name: ‚úÖ Deployment Complete
        if: success()
        run: |
          echo "üéâ Deployment successful!"
          echo "Application is now live on your VPS"

      - name: ‚ùå Deployment Failed
        if: failure()
        run: |
          echo "‚ö†Ô∏è Deployment failed. Check the logs above."
          exit 1
